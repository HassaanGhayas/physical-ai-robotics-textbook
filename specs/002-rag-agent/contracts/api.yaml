openapi: 3.0.1
info:
  title: RAG Agent API
  description: API for RAG (Retrieval-Augmented Generation) agent using OpenAI Agents SDK with Cohere embeddings and Qdrant retrieval
  version: 1.0.0
servers:
  - url: http://localhost:8000
    description: Local development server

paths:
  /ask:
    post:
      summary: Ask a question to the RAG agent
      description: Submit a natural language query to the RAG agent, which retrieves relevant information from the knowledge base and generates a contextually accurate answer with source attribution
      operationId: askQuestion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentRequest'
            examples:
              basic_query:
                summary: Basic query
                value:
                  query: "What is physical AI?"
                  top_k: 5
                  include_sources: true
              simple_query:
                summary: Simple query with defaults
                value:
                  query: "Explain humanoid robotics"
      responses:
        '200':
          description: Successfully generated answer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponse'
              examples:
                success_response:
                  summary: Successful response with sources
                  value:
                    answer: "Physical AI refers to artificial intelligence systems that interact with and manipulate the physical world through embodied agents such as robots. It combines AI algorithms with mechanical actuators and sensors to enable intelligent physical interactions."
                    sources:
                      - content: "Physical AI involves sophisticated AI algorithms controlling complex mechanical bodies..."
                        url: "https://hassaanghayas.github.io/physical-ai-robotics-textbook/docs/intro"
                        chunk_id: "intro_chunk_0"
                        document_id: "intro_doc"
                        similarity_score: 0.87
                        position: 1
                      - content: "The integration of AI and robotics enables autonomous decision-making in physical environments..."
                        url: "https://hassaanghayas.github.io/physical-ai-robotics-textbook/docs/overview"
                        chunk_id: "overview_chunk_2"
                        document_id: "overview_doc"
                        similarity_score: 0.75
                        position: 2
                    metadata:
                      response_time_ms: 3245.5
                      chunk_count: 2
                      embedding_time_ms: 250.0
                      retrieval_time_ms: 150.0
                      generation_time_ms: 2800.0
        '400':
          description: Bad request - invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                empty_query:
                  summary: Empty query error
                  value:
                    error: "validation_error"
                    message: "Query cannot be empty"
                    detail: "The 'query' field is required and must contain at least one character"
                    status_code: 400
                query_too_long:
                  summary: Query length exceeded
                  value:
                    error: "validation_error"
                    message: "Query exceeds maximum length"
                    detail: "Query must be 1000 characters or less"
                    status_code: 400
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                agent_error:
                  summary: Agent processing error
                  value:
                    error: "agent_error"
                    message: "Failed to process query"
                    detail: "Agent encountered an error during processing"
                    status_code: 500
        '503':
          description: Service unavailable - external service failure
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                qdrant_unavailable:
                  summary: Qdrant service unavailable
                  value:
                    error: "service_unavailable"
                    message: "Knowledge base temporarily unavailable"
                    detail: "Qdrant service is not responding"
                    status_code: 503
                openai_unavailable:
                  summary: OpenAI service unavailable
                  value:
                    error: "service_unavailable"
                    message: "AI service temporarily unavailable"
                    detail: "OpenAI API is not responding"
                    status_code: 503

  /health:
    get:
      summary: Health check endpoint
      description: Check the health status of the RAG agent and its dependencies
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                all_healthy:
                  summary: All services healthy
                  value:
                    status: "healthy"
                    services:
                      openai: "connected"
                      cohere: "connected"
                      qdrant: "connected"
                    timestamp: "2025-12-17T12:00:00Z"
        '503':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                qdrant_unhealthy:
                  summary: Qdrant service down
                  value:
                    status: "unhealthy"
                    services:
                      openai: "connected"
                      cohere: "connected"
                      qdrant: "disconnected"
                    timestamp: "2025-12-17T12:00:00Z"

components:
  schemas:
    AgentRequest:
      type: object
      required:
        - query
      properties:
        query:
          type: string
          description: User's natural language question
          minLength: 1
          maxLength: 1000
          example: "What is physical AI?"
        top_k:
          type: integer
          description: Number of document chunks to retrieve
          minimum: 1
          maximum: 10
          default: 5
        include_sources:
          type: boolean
          description: Whether to include source attribution in response
          default: true

    AgentResponse:
      type: object
      required:
        - answer
        - sources
        - metadata
      properties:
        answer:
          type: string
          description: Natural language answer generated by the agent
          minLength: 1
        sources:
          type: array
          items:
            $ref: '#/components/schemas/SourceChunk'
          description: List of retrieved document chunks used to generate the answer
        metadata:
          $ref: '#/components/schemas/ResponseMetadata'

    SourceChunk:
      type: object
      required:
        - content
        - url
        - chunk_id
        - document_id
        - similarity_score
        - position
      properties:
        content:
          type: string
          description: Text content of the retrieved chunk
          minLength: 1
        url:
          type: string
          format: uri
          description: Source URL of the original document
        chunk_id:
          type: string
          description: Identifier for the specific chunk
        document_id:
          type: string
          description: Identifier for the parent document
        similarity_score:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          description: Cosine similarity score
        position:
          type: integer
          minimum: 1
          description: Rank in retrieval results (1-indexed)

    ResponseMetadata:
      type: object
      required:
        - response_time_ms
        - chunk_count
        - embedding_time_ms
        - retrieval_time_ms
        - generation_time_ms
      properties:
        response_time_ms:
          type: number
          format: float
          minimum: 0
          description: Total time taken to process the request in milliseconds
        chunk_count:
          type: integer
          minimum: 0
          description: Number of retrieved chunks
        embedding_time_ms:
          type: number
          format: float
          minimum: 0
          description: Time taken for embedding generation
        retrieval_time_ms:
          type: number
          format: float
          minimum: 0
          description: Time taken for Qdrant retrieval
        generation_time_ms:
          type: number
          format: float
          minimum: 0
          description: Time taken for OpenAI generation

    ErrorResponse:
      type: object
      required:
        - error
        - message
        - status_code
      properties:
        error:
          type: string
          description: Error type or category
          enum:
            - validation_error
            - agent_error
            - service_unavailable
            - timeout
            - rate_limited
            - unknown_error
        message:
          type: string
          description: Human-readable error message
        detail:
          type: string
          description: Optional additional debugging information
        status_code:
          type: integer
          description: HTTP status code
          minimum: 400
          maximum: 599

    HealthResponse:
      type: object
      required:
        - status
        - services
        - timestamp
      properties:
        status:
          type: string
          enum: [healthy, unhealthy]
          description: Overall health status
        services:
          type: object
          properties:
            openai:
              type: string
              enum: [connected, disconnected, unknown]
            cohere:
              type: string
              enum: [connected, disconnected, unknown]
            qdrant:
              type: string
              enum: [connected, disconnected, unknown]
        timestamp:
          type: string
          format: date-time
          description: Timestamp of the health check
