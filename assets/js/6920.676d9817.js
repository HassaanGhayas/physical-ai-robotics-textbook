"use strict";(globalThis.webpackChunkmy_web=globalThis.webpackChunkmy_web||[]).push([[6920],{6920:(e,s,r)=>{r.r(s),r.d(s,{default:()=>I});var t=r(6540),a=r(4586);function n(e){try{const s=new URL(e),r=s.pathname.split("/").filter(e=>e.length>0);return r[r.length-1].replace(/\.[^.]*$/,"").replace(/[-_]/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}catch{return"Document"}}var o=r(4335);const i={NETWORK_ERROR:"NETWORK_ERROR",TIMEOUT:"TIMEOUT",CONNECTION_REFUSED:"CONNECTION_REFUSED",VALIDATION_ERROR:"VALIDATION_ERROR",BAD_REQUEST:"BAD_REQUEST",SERVER_ERROR:"SERVER_ERROR",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",PARSE_ERROR:"PARSE_ERROR",UNKNOWN_ERROR:"UNKNOWN_ERROR"},c={[i.NETWORK_ERROR]:"Unable to connect. Check your internet connection.",[i.TIMEOUT]:"Request timed out. Try a simpler question.",[i.SERVICE_UNAVAILABLE]:"The chatbot is temporarily unavailable. Try again in a moment.",[i.VALIDATION_ERROR]:"Please enter a valid question.",[i.SERVER_ERROR]:"Something went wrong. Please try again.",[i.CONNECTION_REFUSED]:"Unable to connect to the chatbot service. Please try again in a moment.",[i.UNKNOWN_ERROR]:"An unexpected error occurred. Please try again."};function l(e){const s=[];return e.answer&&0!==e.answer.trim().length||s.push("Answer cannot be empty"),Array.isArray(e.sources)||s.push("Sources must be an array"),e.chunk_count!==e.sources.length&&s.push("chunk_count does not match sources array length"),e.sources.forEach((e,r)=>{(e.similarity_score<0||e.similarity_score>1)&&s.push(`Source ${r}: similarity_score must be between 0 and 1`),e.position<1&&s.push(`Source ${r}: position must be a positive integer`),e.url&&u(e.url)||s.push(`Source ${r}: invalid URL`)}),{isValid:0===s.length,errors:s}}function u(e){try{return new URL(e),!0}catch{return!1}}function d(e){if(o.A.isAxiosError(e)){const s=e;if(!s.response)return"ECONNABORTED"===s.code?{code:i.TIMEOUT,message:c[i.TIMEOUT],retryable:!0,originalError:e}:{code:i.NETWORK_ERROR,message:c[i.NETWORK_ERROR],retryable:!0,originalError:e};const r=s.response.status,t=s.response.data;return 400===r?{code:i.VALIDATION_ERROR,message:t?.message||c[i.VALIDATION_ERROR],statusCode:r,type:t?.type,details:t?.details,retryable:!1,originalError:e}:503===r?{code:i.SERVICE_UNAVAILABLE,message:t?.message||c[i.SERVICE_UNAVAILABLE],statusCode:r,type:t?.type,retryable:!0,originalError:e}:r>=500?{code:i.SERVER_ERROR,message:t?.message||c[i.SERVER_ERROR],statusCode:r,type:t?.type,retryable:!0,originalError:e}:{code:i.UNKNOWN_ERROR,message:c[i.UNKNOWN_ERROR],statusCode:r,retryable:!1,originalError:e}}return{code:i.UNKNOWN_ERROR,message:c[i.UNKNOWN_ERROR],retryable:!1,originalError:e}}function m(e){return new Promise(s=>setTimeout(s,e))}function h(e){const s=o.A.create({baseURL:e.baseUrl,timeout:e.timeout||1e4,headers:{"Content-Type":"application/json",...e.headers}}),r=new Map;return s.interceptors.request.use(e=>(console.log(`[API] ${e.method?.toUpperCase()} ${e.url}`),e),e=>(console.error("[API] Request error:",e.message),Promise.reject(e))),s.interceptors.response.use(e=>(console.log(`[API] Response: ${e.status}`),e),e=>(console.error("[API] Response error:",e.message),Promise.reject(e))),{ask:async function(t){const a=function(e){const s=[];return e.query&&0!==e.query.trim().length||s.push("Query cannot be empty"),e.query&&e.query.length>1e3&&s.push("Query exceeds maximum length of 1000 characters"),void 0!==e.top_k&&(!Number.isInteger(e.top_k)||e.top_k<1||e.top_k>20)&&s.push("top_k must be an integer between 1 and 20"),{isValid:0===s.length,errors:s}}(t);if(!a.isValid)return{success:!1,error:{code:"VALIDATION_ERROR",message:a.errors.join(", "),retryable:!1}};const n=e.maxRetries||3,i=e.retryDelay||1e3,c=!1!==e.exponentialBackoff;let u=null;for(let e=0;e<=n;e++)try{const a=o.A.CancelToken.source();t.request_id&&r.set(t.request_id,a),console.log(`[API] Attempt ${e+1}/${n+1} for query: "${t.query.substring(0,50)}..."`);const i=await s.post("/ask",t,{cancelToken:a.token});t.request_id&&r.delete(t.request_id);const c=l(i.data);return c.isValid||console.warn("[API] Response validation failed:",c.errors),console.log(`[API] Success: ${i.data.sources.length} sources, ${i.data.response_time_ms}ms`),{success:!0,data:i.data}}catch(h){if(u=d(h),t.request_id&&r.delete(t.request_id),!u.retryable||e>=n)return console.error(`[API] Failed after ${e+1} attempts:`,u.message),{success:!1,error:u};const s=c?i*Math.pow(2,e):i;console.warn(`[API] Attempt ${e+1} failed, retrying in ${s}ms:`,u.message),await m(s)}return{success:!1,error:u||{code:"UNKNOWN_ERROR",message:"Request failed after all retries",retryable:!1}}},checkHealth:async function(){try{return{success:!0,data:(await s.get("/health")).data}}catch(e){return{success:!1,error:d(e)}}},cancelRequest:function(e){const s=r.get(e);s&&(s.cancel("Request cancelled by user"),r.delete(e),console.log(`[API] Cancelled request: ${e}`))},updateConfig:function(r){Object.assign(e,r),r.baseUrl&&(s.defaults.baseURL=r.baseUrl),r.timeout&&(s.defaults.timeout=r.timeout),console.log("[API] Configuration updated:",r)}}}var g=r(4848);function p(e){return{id:e.id,content:e.content,preview:e.content.substring(0,150)+(e.content.length>150?"...":""),url:e.url,title:n(e.url),chunkId:e.chunk_id,documentId:e.document_id,similarityScore:e.similarity_score,position:e.position}}function R(e,s){switch(s.type){case"SEND_MESSAGE":return{...e,messages:[...e.messages,s.payload.message],isLoading:!0,error:null,currentRequestId:s.payload.message.id};case"RECEIVE_RESPONSE":return{...e,messages:[...e.messages,s.payload.message],isLoading:!1,currentRequestId:null};case"MESSAGE_FAILED":return{...e,messages:e.messages.map(e=>e.id===s.payload.messageId?{...e,status:"failed",error:s.payload.error}:e),isLoading:!1,currentRequestId:null,error:{type:"server",message:s.payload.error.message,timestamp:new Date}};case"SET_LOADING":return{...e,isLoading:s.payload};case"SET_ERROR":return{...e,error:s.payload,isLoading:!1};case"CLEAR_MESSAGES":return{...e,messages:[],error:null,currentRequestId:null};case"TOGGLE_CHAT":return{...e,isOpen:s.payload};case"UPDATE_CONFIG":return{...e,config:{...e.config,...s.payload}};default:return e}}const y=(0,t.createContext)(void 0);function E({children:e}){const{siteConfig:s}=(0,a.A)(),r={messages:[],isLoading:!1,isOpen:!1,currentRequestId:null,error:null,config:{apiBaseUrl:s.customFields?.ragApiUrl||"http://localhost:8000",timeoutMs:s.customFields?.timeoutMs||1e4,maxRetries:s.customFields?.maxRetries||3,retryDelayMs:1e3,topK:5,enabled:!1!==s.customFields?.chatbotEnabled}},[n,o]=(0,t.useReducer)(R,r),i=(0,t.useMemo)(()=>h({baseUrl:n.config.apiBaseUrl,timeout:n.config.timeoutMs,maxRetries:n.config.maxRetries,retryDelay:n.config.retryDelayMs,exponentialBackoff:!0}),[n.config.apiBaseUrl,n.config.timeoutMs,n.config.maxRetries,n.config.retryDelayMs]),c=(0,t.useCallback)(async e=>{const s=(r=e,{id:crypto.randomUUID(),type:"user",content:r.trim(),timestamp:new Date,status:"pending"});var r,t;o({type:"SEND_MESSAGE",payload:{message:s}});try{const r=await i.ask({query:e,top_k:n.config.topK,request_id:s.id});if(r.success)if(r.data.sources&&0!==r.data.sources.length){const e=(t=r.data,{id:crypto.randomUUID(),type:"assistant",content:t.answer,timestamp:new Date,status:"delivered",sources:t.sources.map(p)});o({type:"RECEIVE_RESPONSE",payload:{message:e}})}else{const e={id:crypto.randomUUID(),type:"assistant",content:r.data.answer||"I couldn't find relevant information about that topic in the textbook. Try rephrasing your question or asking about Physical AI and Humanoid Robotics topics covered in this book.",timestamp:new Date,status:"delivered",sources:[]};o({type:"RECEIVE_RESPONSE",payload:{message:e}})}else o({type:"MESSAGE_FAILED",payload:{messageId:s.id,error:{code:r.error.code,message:r.error.message,details:r.error.details,retryable:r.error.retryable}}})}catch(a){o({type:"MESSAGE_FAILED",payload:{messageId:s.id,error:{code:"UNKNOWN_ERROR",message:"An unexpected error occurred",retryable:!1}}})}},[i,n.config.topK]),l=(0,t.useCallback)(async e=>{const s=n.messages.find(s=>s.id===e);s&&"user"===s.type&&await c(s.content)},[n.messages,c]),u=(0,t.useCallback)(()=>{o({type:"CLEAR_MESSAGES"})},[]),d=(0,t.useCallback)(()=>{o({type:"TOGGLE_CHAT",payload:!0})},[]),m=(0,t.useCallback)(()=>{o({type:"TOGGLE_CHAT",payload:!1})},[]),E=(0,t.useCallback)(()=>{o({type:"SET_ERROR",payload:null})},[]),A={state:n,sendMessage:c,retryMessage:l,clearMessages:u,openChat:d,closeChat:m,dismissError:E};return(0,g.jsx)(y.Provider,{value:A,children:e})}var A=r(9060);const b=(0,t.memo)(function({sources:e}){const[s,r]=(0,t.useState)(!1);return e&&0!==e.length?(0,g.jsxs)("div",{className:A.A.sourceList,children:[(0,g.jsxs)("button",{className:A.A.sourceToggle,onClick:()=>r(!s),"aria-expanded":s,"aria-label":(s?"Collapse":"Expand")+" sources",children:[(0,g.jsxs)("span",{children:["Sources (",e.length,")"]}),(0,g.jsx)("span",{className:A.A.toggleIcon,children:s?"\u25bc":"\u25b6"})]}),s&&(0,g.jsx)("div",{className:A.A.sourceItems,children:e.map((e,s)=>(0,g.jsxs)("div",{className:A.A.sourceItem,children:[(0,g.jsxs)("div",{className:A.A.sourceHeader,children:[(0,g.jsxs)("span",{className:A.A.sourcePosition,children:["[",e.position,"]"]}),(0,g.jsx)("span",{className:A.A.sourceTitle,children:e.title}),(0,g.jsxs)("span",{className:`${A.A.sourceScore} ${e.similarityScore>.7?A.A.scoreHigh:e.similarityScore>.5?A.A.scoreMedium:A.A.scoreLow}`,children:["Score: ",e.similarityScore.toFixed(2)]})]}),(0,g.jsxs)("div",{className:A.A.sourcePreview,children:['"',e.preview,'"']}),(0,g.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:A.A.sourceLink,title:`${e.title} (Relevance: ${e.similarityScore.toFixed(2)})`,"aria-label":`Open source document: ${e.title} in new tab`,children:"View full document \u2192"})]},e.id))})]}):null});var N=r(159);const f=(0,t.memo)(function({error:e,onRetry:s}){return(0,g.jsxs)("div",{className:A.A.errorMessage,children:[(0,g.jsxs)("div",{className:A.A.errorContent,children:[(0,g.jsx)("span",{className:A.A.errorIcon,children:"\u26a0\ufe0f"}),(0,g.jsxs)("div",{className:A.A.errorText,children:[(0,g.jsx)("p",{className:A.A.errorMessageText,children:e.message}),e.details&&(0,g.jsx)("p",{className:A.A.errorDetails,children:e.details})]})]}),e.retryable&&s&&(0,g.jsx)("button",{className:A.A.retryButton,onClick:s,"aria-label":"Retry request",children:"Try Again"})]})}),x=(0,t.memo)(function({messages:e,isLoading:s,onRetry:r}){const a=(0,t.useRef)(null);(0,t.useEffect)(()=>{a.current?.scrollIntoView({behavior:"smooth"})},[e,s]);return(0,g.jsxs)("div",{className:A.A.messageList,children:[0===e.length&&!s&&(0,g.jsxs)("div",{className:A.A.emptyState,children:[(0,g.jsx)("p",{children:"Ask a question about Physical AI & Humanoid Robotics!"}),(0,g.jsx)("p",{className:A.A.emptyHint,children:'Try asking: "What is physical AI?" or "How do humanoid robots work?"'})]}),e.map(e=>{return(0,g.jsxs)("div",{className:`${A.A.messageContainer} ${"user"===e.type?A.A.userMessage:A.A.assistantMessage}`,children:[(0,g.jsxs)("div",{className:A.A.messageBubble,children:[(0,g.jsx)("div",{className:A.A.messageContent,children:e.content}),"assistant"===e.type&&e.sources&&e.sources.length>0&&(0,g.jsx)(b,{sources:e.sources}),e.error&&(0,g.jsx)(f,{error:e.error,onRetry:r?()=>r(e.id):void 0})]}),(0,g.jsx)("div",{className:A.A.messageTimestamp,children:(s=e.timestamp,new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}))})]},e.id);var s}),s&&(0,g.jsx)(N.A,{}),(0,g.jsx)("div",{ref:a})]})}),_=(0,t.memo)(function({onSend:e,disabled:s}){const[r,a]=(0,t.useState)(""),[n,o]=(0,t.useState)(null),i=(0,t.useRef)(null);(0,t.useEffect)(()=>{i.current&&(i.current.style.height="auto",i.current.style.height=`${Math.min(i.current.scrollHeight,120)}px`)},[r]);const c=()=>{const s=r.trim();s?s.length>1e3?o("Question is too long (max 1000 characters)"):(o(null),e(s),a(""),i.current&&(i.current.style.height="auto")):o("Please enter a question")},l=r.length,u=l>1e3;return(0,g.jsxs)("div",{className:A.A.inputBar,children:[n&&(0,g.jsx)("div",{className:A.A.validationError,children:n}),(0,g.jsxs)("div",{className:A.A.inputContainer,children:[(0,g.jsx)("textarea",{ref:i,className:A.A.textarea,value:r,onChange:e=>{a(e.target.value),o(null)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),c())},placeholder:"Ask a question about Physical AI & Robotics...",disabled:s,rows:1,"aria-label":"Chat input"}),(0,g.jsxs)("div",{className:A.A.inputActions,children:[(0,g.jsxs)("span",{className:`${A.A.charCounter} ${u?A.A.overLimit:""}`,children:[l,"/1000"]}),(0,g.jsx)("button",{className:A.A.sendButton,onClick:c,disabled:s||!r.trim(),"aria-label":"Send message",children:"Send"})]})]})]})});class v extends t.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("[ErrorBoundary] Caught error:",e,s)}handleReset=()=>{this.setState({hasError:!1,error:void 0})};render(){return this.state.hasError?(0,g.jsxs)("div",{style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--ifm-background-color)",borderRadius:"0.5rem"},children:[(0,g.jsx)("h3",{children:"Something went wrong"}),(0,g.jsx)("p",{style:{color:"var(--ifm-color-secondary)"},children:"The chat interface encountered an error. Please try refreshing the page."}),(0,g.jsx)("button",{onClick:this.handleReset,style:{marginTop:"1rem",padding:"0.5rem 1rem",backgroundColor:"var(--ifm-color-primary)",color:"white",border:"none",borderRadius:"0.25rem",cursor:"pointer"},children:"Try Again"})]}):this.props.children}}function C({onClose:e}){const{state:s,sendMessage:r,retryMessage:a,clearMessages:n,dismissError:o}=function(){const e=(0,t.useContext)(y);if(!e)throw new Error("useChatContext must be used within ChatProvider");return e}(),i=(0,t.useRef)(null),c=((0,t.useRef)(null),(0,t.useCallback)(s=>{"Escape"===s.key&&e()},[e])),l=(0,t.useCallback)(e=>{if("Tab"!==e.key)return;const s=i.current;if(!s)return;const r=s.querySelectorAll('button:not([disabled]), textarea:not([disabled]), a[href], input:not([disabled]), [tabindex]:not([tabindex="-1"])');if(0===r.length)return;const t=r[0],a=r[r.length-1];e.shiftKey?document.activeElement===t&&(e.preventDefault(),a.focus()):document.activeElement===a&&(e.preventDefault(),t.focus())},[]);return(0,t.useEffect)(()=>{document.addEventListener("keydown",c),document.addEventListener("keydown",l);const e=setTimeout(()=>{const e=i.current;if(e){const s=e.querySelector("textarea:not([disabled]), button:not([disabled])");s?.focus()}},100);return()=>{document.removeEventListener("keydown",c),document.removeEventListener("keydown",l),clearTimeout(e)}},[c,l]),(0,g.jsxs)("div",{ref:i,className:A.A.chatModal,role:"dialog","aria-modal":"true","aria-labelledby":"chat-title",children:[(0,g.jsxs)("div",{className:A.A.chatHeader,children:[(0,g.jsxs)("div",{className:A.A.headerContent,children:[(0,g.jsx)("h3",{id:"chat-title",className:A.A.chatTitle,children:"Ask the Knowledge Base"}),(0,g.jsx)("p",{className:A.A.chatSubtitle,children:"Physical AI & Humanoid Robotics"})]}),(0,g.jsxs)("div",{className:A.A.headerActions,children:[s.messages.length>0&&(0,g.jsx)("button",{className:A.A.clearButton,onClick:n,"aria-label":"Clear messages",title:"Clear all messages",children:"\ud83d\uddd1\ufe0f"}),(0,g.jsx)("button",{className:A.A.closeButton,onClick:e,"aria-label":"Close chat",children:"\xd7"})]})]}),s.error&&(0,g.jsxs)("div",{className:A.A.errorBanner,children:[(0,g.jsx)("span",{className:A.A.errorIcon,children:"\u26a0\ufe0f"}),(0,g.jsx)("span",{className:A.A.errorMessage,children:s.error.message}),(0,g.jsx)("button",{className:A.A.dismissButton,onClick:o,"aria-label":"Dismiss error",children:"\xd7"})]}),(0,g.jsx)("div",{className:A.A.chatBody,children:(0,g.jsx)(x,{messages:s.messages,isLoading:s.isLoading,onRetry:a})}),(0,g.jsx)("div",{className:A.A.chatFooter,children:(0,g.jsx)(_,{onSend:r,disabled:s.isLoading})})]})}function I(e){return(0,g.jsx)(v,{children:(0,g.jsx)(E,{children:(0,g.jsx)(C,{...e})})})}}}]);